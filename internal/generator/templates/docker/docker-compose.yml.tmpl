version: '3.8'
services:
  app:
    build: .
    ports:
      - "8080:8080"
    environment:
      - APP_PORT=8080
      - DB_HOST={{if eq .Database "postgres"}}postgres{{else if eq .Database "mysql"}}mysql{{else}}localhost{{end}}
      - DB_PORT={{if eq .Database "postgres"}}5432{{else if eq .Database "mysql"}}3306{{else}}0{{end}}
      - DB_USER={{if eq .Database "postgres"}}postgres{{else if eq .Database "mysql"}}root{{else}}{{end}}
      - DB_PASS={{if eq .Database "sqlite"}}{{else}}password{{end}}
      - DB_NAME={{.ProjectName}}
{{if or (eq .Database "postgres") (eq .Database "mysql")}}    depends_on:
      - {{.Database}}
{{end}}    restart: unless-stopped
{{if eq .Database "postgres"}}
  postgres:
    image: postgres:15-alpine
    environment:
      - POSTGRES_USER=postgres
      - POSTGRES_PASSWORD=password
      - POSTGRES_DB={{.ProjectName}}
    ports:
      - "5432:5432"
    volumes:
      - postgres_data:/var/lib/postgresql/data
    restart: unless-stopped
volumes:
  postgres_data:
{{else if eq .Database "mysql"}}
  mysql:
    image: mysql:8.0
    environment:
      - MYSQL_ROOT_PASSWORD=password
      - MYSQL_DATABASE={{.ProjectName}}
    ports:
      - "3306:3306"
    volumes:
      - mysql_data:/var/lib/mysql
    restart: unless-stopped
volumes:
  mysql_data:
{{end}}
